<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeLeaf.org/extras/spring-security">

<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- adicionar JQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwLAQgxVSNgt4="
            crossorigin="anonymous"></script>


    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <style type="text/css">
        html { margin-top: 5%
          margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        };

    table.striped > tbody > tr:nth-child(odd) {
        background-color: rgba(158, 154, 154, 0.5);
    }

    form input[type=submit]{
    color: white;}
    </style>
    <meta charset="UTF-8">
    <title>Cad. Pessoa</title>
</head>
<body>
    <h5>Spring Boot + Thymeleaf + Material Design Life</h5>
    <fieldset>
        <legend>Cadastro de pessoas</legend>
        <div class="row">

            <div th:each = "m : ${msg}">
                <span th:text="${m}" style="color: red; font-weight: bold;"></span>
            </div>

            <div class="col s20">
                <div class="row">
                    <form action="salvarpessoa" method="post" th:object="${pessoaobj}">
                         <div class="row">
                             <div class="input-field col s1">
                                 <label for="id" class="active">ID</label>
                                 <input th:field="*{id}" readonly="readonly" value="" type="text" placeholder="" id="id"  name="id" class="validate">
                             </div>
                            <div class="input-field col s4">
                                <label for="nome" class="active">Nome</label>
                                <input th:field="*{nome}" value="" type="text" placeholder="NOME" id="nome" name="nome" class="validate">
                            </div>
                            <div class="input-field col s4">
                                <label for="sobrenome" class="active">Sobre nome</label>
                                <input th:field="*{sobrenome}" value="" type="text" placeholder="SOBRE NOME" id="sobrenome" name="sobrenome" class="validate">
                            </div>
                             <div class="input-field col s2">
                                 <label for="sexopessoa" class="active">Sexo</label>
                                 <select class="browser-default" th:field="*{sexopessoa}" id="sexopessoa">
                                     <option value="" disabled selected>--selecione--</option>
                                     <option value="MASCULINO" th:text="Masculino" ></option>
                                     <option value="FEMININO" th:text="Feminino" ></option>
                                 </select>
                             </div>
                             <div class="input-field col s4">
                                 <label for="cep" class="active">Cep</label>
                                 <input th:field="*{cep}" id="cep" name="cep" placeholder="CEP"
                                 >
                             </div>
                             <div class="input-field col s4">
                                 <label for="rua" class="active">Rua</label>
                                 <input th:field="*{rua}" id="rua" name="rua" placeholder="RUA"
                                 >
                             </div>
                             <div class="input-field col s4">
                                 <label for="bairro" class="active">Bairro</label>
                                 <input th:field="*{bairro}" id="bairro" name="bairro" placeholder="BAIRRO"
                                 >
                             </div>
                             <div class="input-field col s4">
                                 <label for="cidade" class="active">Cidade</label>
                                 <input th:field="*{cidade}" id="cidade" name="cidade" placeholder="CIDADE"
                                 >
                             </div>
                             <div class="input-field col s4">
                                 <label for="uf" class="active">Uf</label>
                                 <input th:field="*{uf}" id="uf" name="uf" placeholder="UF"
                                 >
                             </div>
                             <div class="input-field col s4">
                                 <label for="ibge" class="active">Ibge</label>
                                 <input th:field="*{ibge}" id="ibge" name="ibge" placeholder="IBJE"
                                 >
                             </div>
                            <div class="input-field col s3"  sec:authorize="hasRole('ROLE_ADMIN')">
                                <label for="idade" class="active">Idade</label>
                                <input th:field="*{idade}"  type="text" placeholder="IDADE" id="Idade" name="idade" class="validate">
                            </div>
                        </div>
                        <input class="waves-effect waves-light btn" type="submit" value="Salvar">
                        <a class="waves-effect waves-light btn" href="/listapessoas">lista de pessoas</a>
                    </form>
                </div>
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>Campos de pesquisa</legend>
        <form action="pesquisarpessoa" method="post" >
            <div class="row">
                <div class="input-field col s4">
                    <label for="nomepesquisa" class="active">Pesquisar por nome: </label>
                    <input name="nomepesquisa" id="nomepesquisa" class="validate" value="" type="text" placeholder="PESQUISAR NOME">
                </div>
                <div class="input-field col s4">
                    <label class="active" for="pesqsexo">Pesquisa sexo: </label>
                    <select class="browser-default" name="pesqsexo" id="pesqsexo">
                        <option value="">--todos--</option>
                        <option value="MASCULINO" th:text="Masculino" ></option>
                        <option value="FEMININO" th:text="Feminino" ></option>
                    </select>
                </div>
                <div class="input-field col s12">
                    <input class="waves-effect waves-light btn" type="submit" value="Buscar">
                </div>
            </div>
        </form>
    </fieldset>


    <table class="striped" border="1" th:if="${not #lists.isEmpty(pessoas)}">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Sobrenome</th>
                <th>Idade</th>
                <th>Editar</th>
                <th>Excluir</th>
            </tr>
        </thead>
        <tr th:each="pessoa : ${pessoas}">
                <Td th:text="${pessoa.id}"></Td>
                <Td> <a th:href="@{/telefones/{idpessoa}(idpessoa=${pessoa.id})}"><span th:text="${pessoa.nome}"></span></a></Td>
                <Td th:text="${pessoa.sobrenome}"></Td>
                <Td th:text="${pessoa.idade}"></Td>
                <Td> <a th:href="@{/editarpessoa/{idpessoa}(idpessoa=${pessoa.id})}">Editar</a></Td>
                <Td> <a th:href="@{/removerpessoa/{idpessoa}(idpessoa=${pessoa.id})}">Excluir</a></Td>
        </tr>
    </table>
        <div th:if="${pessoas != null and #lists.isEmpty(pessoas)}">
            <p style="color: red;">Nenhuma pessoa encontrada com esse nome.</p>
        </div>




    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        $(document).ready(function() {

            function limpa_formulário_cep() {
                // Limpa valores do formulário de cep.
                $("#rua").val("");
                $("#bairro").val("");
                $("#cidade").val("");
                $("#uf").val("");
                $("#ibge").val("");
                $("#sexopessoa").val("");
            }

            //Quando o campo cep perde o foco.
            $("#cep").blur(function() {

                //Nova variável "cep" somente com dígitos.
                var cep = $(this).val().replace(/\D/g, '');

                //Verifica se campo cep possui valor informado.
                if (cep != "") {

                    //Expressão regular para validar o CEP.
                    var validacep = /^[0-9]{8}$/;

                    //Valida o formato do CEP.
                    if(validacep.test(cep)) {

                        //Preenche os campos com "..." enquanto consulta webservice.
                        $("#rua").val("...");
                        $("#bairro").val("...");
                        $("#cidade").val("...");
                        $("#uf").val("...");
                        $("#ibge").val("...");
                        $("#sexopessoa").val("");

                        //Consulta o webservice viacep.com.br/
                        $.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados) {

                            if (!("erro" in dados)) {
                                //Atualiza os campos com os valores da consulta.
                                $("#rua").val(dados.logradouro);
                                $("#bairro").val(dados.bairro);
                                $("#cidade").val(dados.localidade);
                                $("#uf").val(dados.uf);
                                $("#ibge").val(dados.ibge);
                            } //end if.
                            else {
                                //CEP pesquisado não foi encontrado.
                                limpa_formulário_cep();
                                alert("CEP não encontrado.");
                            }
                        });
                    } //end if.
                    else {
                        //cep é inválido.
                        limpa_formulário_cep();
                        alert("Formato de CEP inválido.");
                    }
                } //end if.
                else {
                    //cep sem valor, limpa formulário.
                    limpa_formulário_cep();
                }
            });
        });

    </script>
</body>
</html>
